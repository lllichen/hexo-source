---
title: 分布式锁
date: 2018-09-12 12:04:56
tags: distribute lock
---

### 锁
锁解决的问题
当线程访问临界变量时，需要设置标记，保证线程访问的原子性和可见性
java中通常通过sychronize 关键字 和 Lock 类来实现 


### 分布式锁
分布式锁解决的是多进程访问临界资源的问题，即在分布式场景下，访问临界资源时，如何保证一致性。思路与
多线程访问一致，即设置一个可以访问的公共边量，阻塞进程，达到一致性，但分布式场景设计网络延时等场景，所以更复杂。

需要保证
安全性
活性


#### 利用 redis 构建分布式锁

redis 是单线程的，redis 的每个操作都是原子操作

redis 事务操作: MULTI EXEC DISCARD WATCH UNWATCH，
redis 事务有如下特性，即当redis 处理事务操作时，redis不会处理其他client端的命令。2.6之后引入luna脚本，一个luna脚本的执行是原子的。

简单分布式锁实现
```
SET resource_name my_random_value NX PX 30000
```

```
if redis.call("get",KEYS[1]) == ARGV[1] then
    return redis.call("del",KEYS[1])
else
    return 0
end
```
存在这么一种情况，即master 创建key，slave 未同步master情况下，导致重复获取锁出现


zookeeper 分布式锁


db 分布式锁